{{<govuk_template}}

{{$head}}
  {{>includes/elements_head}}
  {{>includes/elements_scripts}}
{{/head}}

{{$propositionHeader}}
  {{>includes/propositional_navigation3}}
{{/propositionHeader}}

{{$headerClass}}with-proposition{{/headerClass}}

{{$content}}

<header class="page-header">

<script>

var conditions = [];

function next() { 
  var tokens = [];
  var supported = ['Diabetes','Glaucoma'];

  conditions.sort();

  for(var s=0; s < supported.length; s++) {
    for(var i=0; i < conditions.length; i++) {
      if(conditions[i] == supported[s]) {
        tokens.push(conditions[i].toLowerCase());
      }
    }
  }

  //alert('Tokens: ['+tokens+']');

  // Now we have our conditions, we next to progress onwarrds.
  if(tokens.length > 0) {
    window.location.href = tokens[0]+'-start?flow='+tokens[0]+'&conditions='+tokens;
  } else {
    alert('The only conditions that are supported are: '+supported);
  }
}
  
function checkLayout() {
  if(conditions.length > 0) {
    document.getElementById('none').style.display = 'none';
    document.getElementById('some').style.display = 'block';
    document.getElementById('continue').disabled = false;
  } else {
    document.getElementById('none').style.display = 'block';
    document.getElementById('some').style.display = 'none';
    document.getElementById('continue').disabled = true;
  }
}

function addCondition(condition) {
  conditions.push(condition);
  checkLayout();
  document.getElementById('Remove_'+condition).style.display = 'block';
  document.getElementById('Add_'+condition).style.display = 'none';
}

function removeCondition(condition) {
  //alert('Remove: '+condition);
  for(var i=0; i < conditions.length; i++) {
    if(conditions[i] == condition) {
      conditions[i] = '\0';
      break;
    }
  }
  conditions.sort().reverse().pop();;

  document.getElementById('Remove_'+condition).style.display = 'none';
  document.getElementById('Add_'+condition).style.display = 'block';

  checkLayout();

  //alert(conditions+' -> '+conditions.length);
}

</script>

</header>

<main id="page-container" role="main">

  <h2 class="heading-medium">
    Step 2 of 7
  </h2>

  <h1 class="heading-large">
    Your medical conditions
  </h1> 

  <form id="medical-form" class="form">

    <div class="grid-row">
      <div class="column-half">
        <h2 class="heading-medium">Search for your condition</h2>
          Query <input type="text" id="conditions" name="conditions" list="medical-conditions" value="" size="30" />
          <datalist id="medical-conditions">
            <option>Diabetes</option>
            <option>Diabetes (Type 1)</option>
            <option>Diabetes (Type 2)</option>
            <option>DIAB1 (Online Form)</option>
          </datalist>
          <br/><br/>
          <div id="my-conditions">
            <div id="none">
              <span class="form-hint">(For example, Diabetes, Glaucoma or Epilepsy etc)</span>
            </div>
            <div id="some" class="starthidden"><p>You have selected these conditions:</p></div>
            <a id="Remove_Diabetes" class="starthidden" href="javascript:removeCondition('Diabetes');">- Diabetes</a>
            <a id="Remove_Epilepsy" class="starthidden" href="javascript:removeCondition('Epilepsy');">- Epilepsy</a>
            <a id="Remove_Glaucoma" class="starthidden" href="javascript:removeCondition('Glaucoma');">- Glaucoma</a>
            <a id="Remove_Dementia" class="starthidden" href="javascript:removeCondition('Dementia');">- Dementia</a>
            <a id="Remove_Pacemaker" class="starthidden" href="javascript:removeCondition('Pacemaker');">- Pacemaker</a>
            <a id="Remove_Stroke" class="starthidden" href="javascript:removeCondition('Stroke');">- Stroke</a>
            <a id="Remove_SleepApnoea" class="starthidden" href="javascript:removeCondition('SleepApnoea');">- Sleep Apnoea</a>
            <a id="Remove_Hypertension" class="starthidden" href="javascript:removeCondition('Hypertension');">- Hypertension</a>
          </div>
      </div>

      <div class="column-half" style="border-left: 5px solid #c0c0c0;">
        <div class="">
          <h2 class="heading-medium">Or, add a common one:</h2>
          <div class="column-half">
            <p id="Add_Diabetes"><a href="javascript:addCondition('Diabetes');">+ Diabetes</a></p>
            <p id="Add_Epilepsy"><a href="javascript:addCondition('Epilepsy');">+ Epilepsy</a></p>
            <p id="Add_Glaucoma"><a href="javascript:addCondition('Glaucoma');">+ Glaucoma</a></p>
            <p id="Add_Dementia"><a href="javascript:addCondition('Dementia');">+ Dementia</a></p>
          </div>
          <div class="column-half">
            <p id="Add_Pacemaker"><a href="javascript:addCondition('Pacemaker');">+ Pacemaker</a></p>
            <p id="Add_Stroke"><a href="javascript:addCondition('Stroke');">+ Stroke</a></p>
            <p id="Add_SleepApnoea"><a href="javascript:addCondition('SleepApnoea');">+ Sleep Apnoea</a></p>
            <p id="Add_Hypertension"><a href="javascript:addCondition('Hypertension');">+ Hypertension</a></p>
          </div>
        </div>
      </div>
    </div>
    
    <br/><br/>

    <div class="form-group">
      <input id="continue" type="button" class="button" value="Save and continue" onclick="next()" disabled="true"/> 
    </div>

    <ul>
      <li><a href="javascript:history.go(-1);">Back</a></li>
    </ul>

  </form>

</main>

{{/content}}

{{$bodyEnd}}
{{/bodyEnd}}

{{/govuk_template}}
